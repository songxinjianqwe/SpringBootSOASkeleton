2017-08-14 19:16:50.689 INFO  [main] c.s.s.c.mail.MailControllerTest [StartupInfoLogger.java : 48] - Starting MailControllerTest on LAPTOP-0E5JL9PN with PID 9492 (started by songx in D:\idea\SpringBootSkeleton\skeleton)
2017-08-14 19:16:50.691 INFO  [main] c.s.s.c.mail.MailControllerTest [SpringApplication.java : 597] - The following profiles are active: dev
2017-08-14 19:17:27.611 INFO  [main] c.s.s.c.mail.MailControllerTest [StartupInfoLogger.java : 57] - Started MailControllerTest in 38.094 seconds (JVM running for 39.83)
2017-08-14 19:17:28.006 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.controller.mail.MailController.findMails(Long,String,Integer,Integer,String) ] begins with Parameters: [2, receiver, 1, 5, all]
2017-08-14 19:17:28.018 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] begins with Parameters: [2, 1, 5, ALL]
2017-08-14 19:17:28.315 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==>  Preparing: SELECT count(0) FROM mail WHERE receiver = ? 
2017-08-14 19:17:28.518 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:17:28.558 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - <==      Total: 1
2017-08-14 19:17:28.560 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==>  Preparing: select id, sender ,receiver , mail_status,text from mail where receiver = ? LIMIT 5 
2017-08-14 19:17:28.563 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:17:28.568 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.570 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:17:28.575 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.576 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.577 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 2(Long)
2017-08-14 19:17:28.579 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.581 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.582 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:17:28.590 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.593 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.593 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:17:28.595 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.596 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.597 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:17:28.599 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.600 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.601 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 15(Long)
2017-08-14 19:17:28.603 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.605 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.605 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 16(Long)
2017-08-14 19:17:28.607 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.608 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.609 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 17(Long)
2017-08-14 19:17:28.610 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.611 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - <==      Total: 5
2017-08-14 19:17:28.626 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==>  Preparing: update mail set mail_status = ? where id in ( ? , ? , ? , ? , ? ) 
2017-08-14 19:17:28.630 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==> Parameters: 1(Integer), 1(Long), 15(Long), 19(Long), 20(Long), 21(Long)
2017-08-14 19:17:28.644 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - <==    Updates: 5
2017-08-14 19:17:28.645 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:17:28.645 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.controller.mail.MailController.findMails(Long,String,Integer,Integer,String) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:17:28.681 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] begins with Parameters: [2, 1, 5, ALL]
2017-08-14 19:17:28.684 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==>  Preparing: SELECT count(0) FROM mail WHERE receiver = ? 
2017-08-14 19:17:28.685 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:17:28.687 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - <==      Total: 1
2017-08-14 19:17:28.688 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==>  Preparing: select id, sender ,receiver , mail_status,text from mail where receiver = ? LIMIT 5 
2017-08-14 19:17:28.689 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:17:28.691 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.691 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:17:28.693 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.695 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.696 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 2(Long)
2017-08-14 19:17:28.698 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.699 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.701 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:17:28.703 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.704 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.705 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:17:28.708 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.710 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:17:28.711 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:17:28.715 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.718 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.719 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 15(Long)
2017-08-14 19:17:28.721 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.728 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.728 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 16(Long)
2017-08-14 19:17:28.733 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.737 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:17:28.738 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 17(Long)
2017-08-14 19:17:28.741 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:17:28.742 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - <==      Total: 5
2017-08-14 19:17:28.744 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==>  Preparing: update mail set mail_status = ? where id in ( ? , ? , ? , ? , ? ) 
2017-08-14 19:17:28.745 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==> Parameters: 1(Integer), 1(Long), 15(Long), 19(Long), 20(Long), 21(Long)
2017-08-14 19:17:28.750 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - <==    Updates: 5
2017-08-14 19:17:28.750 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:17:28.822 INFO  [main] c.s.s.c.mail.MailControllerTest [MailControllerTest.java : 60] - result:[MailDO(id=1, sender=UserDO(id=1, username=admin, password=null, nickname=orange's cat, realName=null, sex=M, birthday=1996-12-26, regTime=2017-04-27T19:35:29, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\5\4\1493868411078_cat.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=1, sendTime=2017-05-04T16:18:08, mailText=hehe)), MailDO(id=15, sender=UserDO(id=1, username=admin, password=null, nickname=orange's cat, realName=null, sex=M, birthday=1996-12-26, regTime=2017-04-27T19:35:29, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\5\4\1493868411078_cat.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=14, sendTime=2017-05-09T19:22:09, mailText=HelloWorld)), MailDO(id=19, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=15, sendTime=2017-05-09T19:40:05, mailText=HelloWorld)), MailDO(id=20, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=16, sendTime=2017-07-12T13:34:36, mailText=HelloWorld)), MailDO(id=21, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=17, sendTime=2017-07-12T16:27:25, mailText=haha))]
2017-08-14 19:17:28.940 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-08-14 19:17:28.991 INFO  [main] c.s.s.s.a.impl.ArticleServiceImpl [ArticleServiceImpl.java : 67] - DSL:{
  "function_score" : {
    "functions" : [ {
      "filter" : {
        "match" : {
          "title" : {
            "query" : "Hybrid",
            "type" : "phrase",
            "analyzer" : "ik_smart"
          }
        }
      },
      "weight" : 1000.0
    }, {
      "filter" : {
        "match" : {
          "body" : {
            "query" : "Hybrid",
            "type" : "phrase",
            "analyzer" : "ik_smart"
          }
        }
      },
      "weight" : 500.0
    } ],
    "score_mode" : "sum",
    "min_score" : 10.0
  }
}
2017-08-14 19:17:29.982 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-08-14 19:17:29.984 INFO  [main] c.s.s.s.article.ArticleServiceTest [ArticleServiceTest.java : 70] - size:1
2017-08-14 19:17:29.986 INFO  [main] c.s.s.s.article.ArticleServiceTest [ArticleServiceTest.java : 72] - ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)
2017-08-14 19:17:30.025 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ List cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContaining(String) ] begins with Parameters: [Hybrid]
2017-08-14 19:17:30.273 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ List cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContaining(String) ] ends with Result: [ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)]
2017-08-14 19:17:30.315 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Iterable cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findAll() ] begins with Parameters: []
2017-08-14 19:17:30.331 INFO  [main] c.s.s.s.a.impl.ArticleServiceImpl [ArticleServiceImpl.java : 44] - iterable className:org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl
2017-08-14 19:17:30.331 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Iterable cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findAll() ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-08-14 19:17:30.352 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ void cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.saveAll(List) ] begins with Parameters: [[ArticleDO(id=1, author=陆奇, title=成为优秀工程师的五个方法, body=首先要相信技术，我刚才已经讲了，整个我们工业界，特别是像百度这样的公司，对技术坚定的、不动摇的信念特别重要。

我也分享一下，盖茨提到微软公司的宗旨就是：写软件代表的是世界的将来。

为什么？未来任何一个工业都会变成软件工业。盖茨是对的，因为任何工业任何行业自动化的程度会越来越高，最后你所处理的就是信息和知识。

但现在软件的做法又往前提了一次，因为在人工智能时代，不光是写代码，你必须懂算法，懂硬件，懂数据，整个人工智能的开发过程有一个很大程度的提高，但是，技术，特别是我们这个工业所代表的技术一定是将来任何工业的前沿。

所以 我们一定要有一个坚定不移的深刻的理念，相信整个世界终究是为技术所驱动的。), ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)]]
2017-08-14 19:17:31.378 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ void cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.saveAll(List) ] ends with Result: null
2017-08-14 19:18:39.028 INFO  [main] c.s.s.c.mail.MailControllerTest [StartupInfoLogger.java : 48] - Starting MailControllerTest on LAPTOP-0E5JL9PN with PID 11228 (started by songx in D:\idea\SpringBootSkeleton\skeleton)
2017-08-14 19:18:39.030 INFO  [main] c.s.s.c.mail.MailControllerTest [SpringApplication.java : 597] - The following profiles are active: dev
2017-08-14 19:19:17.928 INFO  [main] c.s.s.c.mail.MailControllerTest [StartupInfoLogger.java : 57] - Started MailControllerTest in 39.901 seconds (JVM running for 41.791)
2017-08-14 19:19:18.465 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.controller.mail.MailController.findMails(Long,String,Integer,Integer,String) ] begins with Parameters: [2, receiver, 1, 5, all]
2017-08-14 19:19:18.475 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] begins with Parameters: [2, 1, 5, ALL]
2017-08-14 19:19:18.666 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==>  Preparing: SELECT count(0) FROM mail WHERE receiver = ? 
2017-08-14 19:19:18.970 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:19:19.003 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - <==      Total: 1
2017-08-14 19:19:19.006 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==>  Preparing: select id, sender ,receiver , mail_status,text from mail where receiver = ? LIMIT 5 
2017-08-14 19:19:19.009 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:19:19.013 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.015 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:19:19.021 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.023 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.024 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 2(Long)
2017-08-14 19:19:19.026 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.028 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.033 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:19:19.045 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.048 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.049 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:19:19.051 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.053 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.054 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:19:19.057 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.058 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.059 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 15(Long)
2017-08-14 19:19:19.064 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.065 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.066 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 16(Long)
2017-08-14 19:19:19.069 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.070 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.071 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 17(Long)
2017-08-14 19:19:19.074 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.075 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - <==      Total: 5
2017-08-14 19:19:19.096 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==>  Preparing: update mail set mail_status = ? where id in ( ? , ? , ? , ? , ? ) 
2017-08-14 19:19:19.102 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==> Parameters: 1(Integer), 1(Long), 15(Long), 19(Long), 20(Long), 21(Long)
2017-08-14 19:19:19.106 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - <==    Updates: 5
2017-08-14 19:19:19.108 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:19:19.108 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.controller.mail.MailController.findMails(Long,String,Integer,Integer,String) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:19:19.161 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] begins with Parameters: [2, 1, 5, ALL]
2017-08-14 19:19:19.163 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==>  Preparing: SELECT count(0) FROM mail WHERE receiver = ? 
2017-08-14 19:19:19.164 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:19:19.166 DEBUG [main] d.c.s.s.d.m.M.findByReceiver_COUNT [BaseJdbcLogger.java : 159] - <==      Total: 1
2017-08-14 19:19:19.167 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==>  Preparing: select id, sender ,receiver , mail_status,text from mail where receiver = ? LIMIT 5 
2017-08-14 19:19:19.168 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - ==> Parameters: 2(Long)
2017-08-14 19:19:19.170 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.171 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:19:19.173 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.174 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.175 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 2(Long)
2017-08-14 19:19:19.186 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.189 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.193 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 1(Long)
2017-08-14 19:19:19.200 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.203 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.205 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:19:19.208 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.211 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, username, nickname, sex, birthday, reg_time,avatar from user where id = ? 
2017-08-14 19:19:19.212 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - ====> Parameters: 14(Long)
2017-08-14 19:19:19.214 DEBUG [main] d.c.s.s.d.u.U.findBriefInfoById [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.216 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.217 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 15(Long)
2017-08-14 19:19:19.219 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.220 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.222 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 16(Long)
2017-08-14 19:19:19.225 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.226 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====>  Preparing: select id, send_time , mail_text from mail_text where id = ? 
2017-08-14 19:19:19.227 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - ====> Parameters: 17(Long)
2017-08-14 19:19:19.229 DEBUG [main] d.c.s.s.d.m.M.selectByPrimaryKey [BaseJdbcLogger.java : 159] - <====      Total: 1
2017-08-14 19:19:19.230 DEBUG [main] d.c.s.s.d.m.M.findByReceiver [BaseJdbcLogger.java : 159] - <==      Total: 5
2017-08-14 19:19:19.231 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==>  Preparing: update mail set mail_status = ? where id in ( ? , ? , ? , ? , ? ) 
2017-08-14 19:19:19.232 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - ==> Parameters: 1(Integer), 1(Long), 15(Long), 19(Long), 20(Long), 21(Long)
2017-08-14 19:19:19.235 DEBUG [main] d.c.s.s.d.m.M.updateStatus [BaseJdbcLogger.java : 159] - <==    Updates: 5
2017-08-14 19:19:19.236 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.service.mail.impl.MailServiceImpl.findByReceiver(Long,int,int,MailStatus) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=5, startRow=1, endRow=5, total=5, pages=1, list=Page{count=true, pageNum=1, pageSize=5, startRow=0, endRow=5, total=5, pages=1, reasonable=true, pageSizeZero=true}, prePage=0, nextPage=0, isFirstPage=true, isLastPage=true, hasPreviousPage=false, hasNextPage=false, navigatePages=8, navigateFirstPage1, navigateLastPage1, navigatepageNums=[1]}
2017-08-14 19:19:19.324 INFO  [main] c.s.s.c.mail.MailControllerTest [MailControllerTest.java : 60] - result:[MailDO(id=1, sender=UserDO(id=1, username=admin, password=null, nickname=orange's cat, realName=null, sex=M, birthday=1996-12-26, regTime=2017-04-27T19:35:29, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\5\4\1493868411078_cat.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=1, sendTime=2017-05-04T16:18:08, mailText=hehe)), MailDO(id=15, sender=UserDO(id=1, username=admin, password=null, nickname=orange's cat, realName=null, sex=M, birthday=1996-12-26, regTime=2017-04-27T19:35:29, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\5\4\1493868411078_cat.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=14, sendTime=2017-05-09T19:22:09, mailText=HelloWorld)), MailDO(id=19, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=15, sendTime=2017-05-09T19:40:05, mailText=HelloWorld)), MailDO(id=20, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=16, sendTime=2017-07-12T13:34:36, mailText=HelloWorld)), MailDO(id=21, sender=UserDO(id=14, username=user1, password=null, nickname=user1, realName=null, sex=M, birthday=null, regTime=2017-05-05T23:47:46, email=null, phone=null, roles=null, userStatus=null, avatar=\WEB-INF\uploads\user\image\2017\7\12\1499836795784_1496205207202.jpeg), receiver=UserDO(id=2, username=admin2, password=null, nickname=admin2, realName=null, sex=M, birthday=1995-12-10, regTime=2017-04-28T09:03:38, email=null, phone=null, roles=null, userStatus=null, avatar=null), mailStatus=VIEWED, text=MailTextDO(id=17, sendTime=2017-07-12T16:27:25, mailText=haha))]
2017-08-14 19:19:19.431 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-08-14 19:19:19.472 INFO  [main] c.s.s.s.a.impl.ArticleServiceImpl [ArticleServiceImpl.java : 67] - DSL:{
  "function_score" : {
    "functions" : [ {
      "filter" : {
        "match" : {
          "title" : {
            "query" : "Hybrid",
            "type" : "phrase",
            "analyzer" : "ik_smart"
          }
        }
      },
      "weight" : 1000.0
    }, {
      "filter" : {
        "match" : {
          "body" : {
            "query" : "Hybrid",
            "type" : "phrase",
            "analyzer" : "ik_smart"
          }
        }
      },
      "weight" : 500.0
    } ],
    "score_mode" : "sum",
    "min_score" : 10.0
  }
}
2017-08-14 19:19:19.575 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-08-14 19:19:19.575 INFO  [main] c.s.s.s.article.ArticleServiceTest [ArticleServiceTest.java : 70] - size:1
2017-08-14 19:19:19.576 INFO  [main] c.s.s.s.article.ArticleServiceTest [ArticleServiceTest.java : 72] - ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)
2017-08-14 19:19:19.587 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ List cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContaining(String) ] begins with Parameters: [Hybrid]
2017-08-14 19:19:19.911 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ List cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContaining(String) ] ends with Result: [ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)]
2017-08-14 19:19:20.174 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Iterable cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findAll() ] begins with Parameters: []
2017-08-14 19:19:20.208 INFO  [main] c.s.s.s.a.impl.ArticleServiceImpl [ArticleServiceImpl.java : 44] - iterable className:org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl
2017-08-14 19:19:20.208 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Iterable cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findAll() ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-08-14 19:19:20.221 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ void cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.saveAll(List) ] begins with Parameters: [[ArticleDO(id=1, author=陆奇, title=成为优秀工程师的五个方法, body=首先要相信技术，我刚才已经讲了，整个我们工业界，特别是像百度这样的公司，对技术坚定的、不动摇的信念特别重要。

我也分享一下，盖茨提到微软公司的宗旨就是：写软件代表的是世界的将来。

为什么？未来任何一个工业都会变成软件工业。盖茨是对的，因为任何工业任何行业自动化的程度会越来越高，最后你所处理的就是信息和知识。

但现在软件的做法又往前提了一次，因为在人工智能时代，不光是写代码，你必须懂算法，懂硬件，懂数据，整个人工智能的开发过程有一个很大程度的提高，但是，技术，特别是我们这个工业所代表的技术一定是将来任何工业的前沿。

所以 我们一定要有一个坚定不移的深刻的理念，相信整个世界终究是为技术所驱动的。), ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)]]
2017-08-14 19:19:20.750 INFO  [main] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ void cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.saveAll(List) ] ends with Result: null
